/*! barrita - v0.1.0 - Build: 2014-05-09 
Copyright (c) 2014 Javier Alejandro Alvarez <neiker@gmail.com> 
Licensed under the MIT License */
!function(a){"function"==typeof define&&define.amd&&define("barrita",["jQuery"],a),window.jQuery&&a(window.jQuery)}(function(a){"use strict";function b(b,c){if("object"!==a.type(c))throw new Error("Options should be an object");var d={};this.set=function(a,b){return d[a]=b},this.get=function(a){return d[a]||void 0},this.$el=b,this.set("options",c),this.init()}function c(){var c=Array.prototype.slice.call(arguments),e=c.shift();if(!(e instanceof a))throw new Error("Invalid Element");var g,h;return void 0===c[0]||"object"===a.type(c[0])?h=a.extend({},d,c.shift()):g=c.shift(),e.each(function(){var d=a(this),e=d.data("barrita");if(e){if("string"!==a.type(g)||!f[g])throw new Error("Invalid action");f[g].apply(e,c)}else d.data("barrita",new b(d,h)),d.one("barrita:destroy",function(){d.removeData("barrita")});return e})}var d={resize:"auto",hoverTimeout:500},e=function(){try{return parseInt(navigator.userAgent.match(/MSIE (\d+)\.(\d+)/)[1],10)}catch(a){return null}}();b.prototype={init:function(){this.get("initialized")||(this.initDom(),this.setEvents(),this.setBarHeight(),this.set("initialized",!0),this.$el.trigger("barrita:init",this))},destroy:function(){this.get("initialized")&&(this.removeEvents(),this.restoreDom(),this.set("initialized",!1),this.$el.trigger("barrita:destroy"))},initDom:function(){this.$el=this.$el.addClass("barrita"),this.$viewPort=a("<div/>").addClass("barritaViewport"),this.$content=a("<div />").addClass("barritaContent"),this.$scrollRail=a("<div />").addClass("barritaRail"),this.$scrollBar=a("<div />").addClass("barritaHandler"),this.$content.append(this.$el.children().detach()),this.$viewPort.append(this.$content),this.$scrollRail.append(this.$scrollBar),this.$el.empty().append(this.$viewPort).append(this.$scrollRail),a.isNumeric(this.get("options").hoverTimeout)||this.$scrollRail.addClass("barritaHover")},restoreDom:function(){this.$el.removeClass("barrita");var a=this.$content.children().detach();this.$viewPort.remove(),this.$scrollRail.remove(),this.$el.empty().append(a)},active:function(b){if(void 0!==b){if(this.get("active")===b)return;this.set("active",b),this.$scrollRail.toggleClass("barritaActive",this.get("active")),a("body").toggleClass("barritaActive",this.get("active"))}return this.get("active")},hover:function(b){if(void 0!==b){var c=function(){this.get("hover")!==b&&(this.set("hover",b),this.$scrollRail.toggleClass("barritaHover",this.get("hover")))}.bind(this);clearTimeout(this.get("hoverTimeout"));var d=this.get("options").hoverTimeout;this.get("hover")&&0!==d?a.isNumeric(d)&&this.set("hoverTimeout",setTimeout(c,d)):c()}return this.get("hover")},setBarHeight:function(){var a=100/this.$content.height()*this.$el.height();a?a>=100?this.$scrollRail.addClass("hide"):this.get("scrollBarHeight")!==a&&(this.set("scrollBarHeight",a),this.$scrollRail.removeClass("hide"),this.$scrollBar.css({height:""+a+"%"}),this.setBarPosition()):this.destroy()},setBarPosition:function(a){var b;void 0===a?b=100/this.$content.height()*this.$viewPort.scrollTop():(a+this.$scrollBar.height()>this.$scrollRail.height()&&(a=this.$scrollRail.height()-this.$scrollBar.height()),b=100/this.$scrollRail.height()*a),this.$scrollBar.css({top:String(b+"%")}),this.$el.trigger("barrita:positionChange",{scrollTop:this.$viewPort.scrollTop(),onTop:!Math.floor(b),onBottom:100===Math.ceil(b+this.get("scrollBarHeight"))})},setContentPosition:function(a){void 0===a&&(a=100/this.$scrollRail.height()*this.$scrollBar.position().top,a=this.$content.height()/100*a),this.$viewPort.get(0).scrollTop=a},draggableStart:function(){this.active(!0);var b=this.set("draggable",{});return b.scrollHeight=this.$scrollRail.height(),b.bottomLimit=this.$scrollRail.get(0).offsetHeight-this.$scrollBar.height(),e&&a(document).on("selectstart",!1),a(e?document:window).on("mousemove",this.drag=this.draggableDrag.bind(this)).on("mouseup",this.stopDrag=this.draggableStop.bind(this)),!1},draggableDrag:function(a){var b=this.get("draggable"),c=a.pageY;return b.toTop=parseInt(this.$scrollBar.css("top"),10),b.lastPosition&&(b.toTop+=c-b.lastPosition),b.toTop<0||b.toTop>b.bottomLimit?void 0:(b.lastPosition=c,this.setBarPosition(b.toTop),this.setContentPosition(),!1)},draggableStop:function(){return this.active(!1),this.set("draggable",{}),e&&a(document).on("selectstart",!0),a(e?document:window).off("mousemove",this.drag).off("mouseup",this.stopDrag),!1},setEvents:function(){return this.$el.on("mouseenter",this.hover.bind(this,!0)).on("mouseleave",this.hover.bind(this,!1)),this.$scrollBar.on("mousedown",this.draggableStart.bind(this)),this.$viewPort.on("scroll",function(){this.active()||this.setBarPosition()}.bind(this)),"auto"===this.get("options").resize&&this.set("resizeInterval",setInterval(this.setBarHeight.bind(this),100)),!0},removeEvents:function(){clearInterval(this.get("resizeInterval")),a(e?document:window).off("mousemove",this.drag).off("mouseup",this.stopDrag)}};var f={resize:function(){this.setBarHeight()},destroy:function(){this.destroy()},setPosition:function(a,b){this.setContentPosition(a),this.setBarPosition(),b&&(this.hover(!0),this.hover(!1))},setContent:function(a){this.$content.html(a)},addContent:function(a){this.$content.append(a)}};return a.fn.extend({barrita:function(){return c.apply(null,[a(this)].concat(Array.prototype.slice.call(arguments)))}}),c});